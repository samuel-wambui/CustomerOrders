name: Deploy to Heroku

on:
  push:
    branches:
      - master  # or main, depending on your branch name

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Checkout the code from your repository
      - name: Checkout code
        uses: actions/checkout@v2

      # Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'  # You can use the version that your project uses

      # Install dependencies from requirements.txt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Set up Heroku CLI
      - name: Set up Heroku CLI
        uses: akshnz/heroku-cli-action@v1

      # Log in to Heroku using the API Key
      - name: Heroku Login
        run: |
          echo "machine api.heroku.com" > ~/.netrc
          echo "  login=$HEROKU_EMAIL" >> ~/.netrc
          echo "  password=$HEROKU_API_KEY" >> ~/.netrc

      # Deploy to Heroku
      - name: Deploy to Heroku
        run: |
          git remote add heroku https://git@heroku.com/customerorders.git  # Replace with your Heroku app name
          git push heroku master  # Make sure your repository uses the correct branch (main or master)

      # Run database migrations
      - name: Run migrations
        run: |
          heroku run python manage.py migrate --app customerorders  # Use your Heroku app name

      # Collect static files
      - name: Collect static files
        run: |
          heroku run python manage.py collectstatic --noinput --app customerorders  # Use your Heroku app name
